#!/bin/bash

PWD=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)

IMAGE_TO_CHECK=$1
SEARCH_TERMS=$2
PULL_SECRETS_FILE=${PULL_SECRET:-$HOME/pull-secret.txt}
GREP_PATTERN=$(echo "${SEARCH_TERMS}" | tr ',' '|')
SHELL_CMD="rpm -qa | grep -Ei '${GREP_PATTERN}'"

echo "Searching HO image"
podman pull --tls-verify=false "${IMAGE_TO_CHECK}" --authfile "${PULL_SECRETS_FILE}" --quiet
podman run -it --entrypoint=sh "${IMAGE_TO_CHECK}" -c "${SHELL_CMD}"
